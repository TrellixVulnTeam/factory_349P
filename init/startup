#!/bin/sh
# Copyright (c) 2014 The Chromium OS Authors. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

MYDIR="$(dirname "$(readlink -f "$0")")"
FACTORY_BASE="/usr/local/factory"

main() {
  # Install console (VT2) customizations
  mount --bind "${MYDIR}/profile.d/vt2.sh" /etc/profile.d/cursor.sh

  # Non-telemetry approach is not stable yet, so we want to enable it only when
  # specified. Delete the "use-telemetry" file to proceed.
  [ -f "${MYDIR}/use-telemetry" ] && exit

  if [ -f "${FACTORY_BASE}/py/goofy/GOOFY_SPLIT" ]; then
    # Load presenter app if we are running goofy_presenter.
    if [ -f "${MYDIR}/run_goofy_presenter" ]; then
      mount --bind "${MYDIR}/etc/presenter.conf" /etc/chrome_dev.conf
    fi
    # Leave UI as is for goofy_device for now.
  else
    # Install UI configurations
    mount --bind "${MYDIR}/etc/chrome_dev.conf" /etc/chrome_dev.conf
  fi
}

main "$@"
